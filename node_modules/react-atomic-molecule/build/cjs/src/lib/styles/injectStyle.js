"use strict";

var _interopRequireDefault = require("reshow-runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _winDoc = require("win-doc");

var _createEl = require("create-el");

var _cssQuerySelector = _interopRequireDefault(require("css-query-selector"));

var _reshowConstant = require("reshow-constant");

var _store = _interopRequireDefault(require("./store.js"));

var _stylesToCSS = _interopRequireDefault(require("./stylesToCSS"));

var appendCss = function appendCss(cssArr) {
  (0, _reshowConstant.KEYS)(cssArr).forEach(function (key) {
    var id = "react-style-" + key;

    var styleDom = _cssQuerySelector["default"].one("#" + id);

    var css = cssArr[key];

    if (styleDom) {
      styleDom.innerHTML = css;
    } else {
      styleDom = (0, _createEl.create)("style")()({
        id: id,
        innerHTML: css
      });
      (0, _createEl.inject)(function () {
        return (0, _winDoc.doc)().getElementsByTagName("head")[0];
      })(styleDom);
    }
  });
};

var injectStyle = function injectStyle() {
  if (!_store["default"].newStyles.length) {
    // We are in Node or Styles are already injected
    return null;
  }

  var compiled = (0, _stylesToCSS["default"])(_store["default"].newStyles);
  _store["default"].lastCompiled = compiled;
  _store["default"].newStyles = [];
  (0, _reshowConstant.KEYS)(compiled.styleIds).forEach(function (key) {
    return _store["default"].registry[key] = compiled.styleIds[key];
  });

  if (compiled.css) {
    if ((0, _winDoc.doc)().URL) {
      appendCss(compiled.cssArr);
    } else {
      console.log(compiled.css);
    }
  }
};

var _default = injectStyle;
exports["default"] = _default;
module.exports = exports.default;