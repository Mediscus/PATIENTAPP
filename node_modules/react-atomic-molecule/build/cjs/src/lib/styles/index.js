"use strict";

var _interopRequireDefault = require("reshow-runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _typeof2 = _interopRequireDefault(require("reshow-runtime/helpers/typeof"));

var _ucfirstJs = _interopRequireDefault(require("ucfirst-js"));

var _StyleObject = _interopRequireDefault(require("./StyleObject"));

var _store = _interopRequireDefault(require("./store"));

var _cssNumberToUnit = _interopRequireDefault(require("./cssNumberToUnit"));

var _reshowConstant = require("reshow-constant");

var Browser = {
  webkit: "Webkit",
  ms: "ms",
  moz: "Moz"
};

var genStyleId = function genStyleId() {
  _store["default"].counter += 1;
  return "c" + _store["default"].counter + "_";
};

var createStyle = function createStyle(css, selector, styleId) {
  if (!css) {
    return;
  }

  if (_reshowConstant.UNDEFINED === (0, _typeof2["default"])(styleId)) {
    styleId = genStyleId();
  } else if (_store["default"].registry[styleId]) {
    return _store["default"].registry[styleId];
  }

  if (!(0, _reshowConstant.IS_ARRAY)(css)) {
    css = [css];
  }

  var styles = [];
  css.forEach(function (one, i) {
    styles[i] = {};
    (0, _reshowConstant.KEYS)(one).forEach(function (key) {
      if ((0, _reshowConstant.IS_ARRAY)(one[key]) && 1 === one[key].length) {
        var ucFirstKey = (0, _ucfirstJs["default"])(key);
        styles[i][Browser.webkit + ucFirstKey] = styles[i][Browser.ms + ucFirstKey] = styles[i][Browser.moz + ucFirstKey] = styles[i][key] = (0, _cssNumberToUnit["default"])(key, one[key][0]);
      } else {
        styles[i][key] = (0, _cssNumberToUnit["default"])(key, one[key]);
      }
    });
  });
  var styleDecl = new _StyleObject["default"](styles, selector, styleId);

  _store["default"].newStyles.push(styleDecl);

  return styleDecl;
};

var _default = createStyle; // reactStyle(css, selector, styleId)

exports["default"] = _default;
module.exports = exports.default;