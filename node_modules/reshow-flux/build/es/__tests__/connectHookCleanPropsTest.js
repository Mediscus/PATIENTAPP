import _classCallCheck from "reshow-runtime/es/helpers/classCallCheck";
import _createClass from "reshow-runtime/es/helpers/createClass";
import _assertThisInitialized from "reshow-runtime/es/helpers/assertThisInitialized";
import _inherits from "reshow-runtime/es/helpers/inherits";
import _createSuper from "reshow-runtime/es/helpers/createSuper";
import _defineProperty from "reshow-runtime/es/helpers/defineProperty";
import _objectSpread from "reshow-runtime/es/helpers/objectSpread2";
import _objectWithoutProperties from "reshow-runtime/es/helpers/objectWithoutProperties";
import _slicedToArray from "reshow-runtime/es/helpers/slicedToArray";
var _excluded = ["storeLocator"];
import React, { Component, StrictMode } from "react";
import { createReducer } from "reshow-flux-base";
import { expect } from "chai";
import { mount } from "reshow-unit";
import useConnect from "../useConnect";
describe("Connect Hook (clean Props)", function () {
  var reducer;
  beforeEach(function () {
    reducer = createReducer(function (state, action) {
      return action;
    }, {});
  });
  it("test clean props", function (done) {
    var _reducer = reducer,
        _reducer2 = _slicedToArray(_reducer, 2),
        store = _reducer2[0],
        dispatch = _reducer2[1];

    var Foo = function Foo(props) {
      var state = useConnect({
        storeLocator: function storeLocator() {
          return store;
        },
        calculateState: function calculateState(prevState, props) {
          return store.getState();
        }
      })(props);

      var storeLocator = props.storeLocator,
          otherProps = _objectWithoutProperties(props, _excluded);

      return /*#__PURE__*/React.createElement("div", _objectSpread(_objectSpread({}, otherProps), state));
    };

    var Bar = /*#__PURE__*/function (_Component) {
      _inherits(Bar, _Component);

      var _super = _createSuper(Bar);

      function Bar() {
        var _this;

        _classCallCheck(this, Bar);

        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
          args[_key] = arguments[_key];
        }

        _this = _super.call.apply(_super, [this].concat(args));

        _defineProperty(_assertThisInitialized(_this), "state", {
          p: null
        });

        return _this;
      }

      _createClass(Bar, [{
        key: "render",
        value: function render() {
          return /*#__PURE__*/React.createElement(Foo, this.state.p);
        }
      }]);

      return Bar;
    }(Component);

    var wrap = mount( /*#__PURE__*/React.createElement(Bar, null));
    wrap.setState({
      p: {
        foo: "a",
        bar: "b"
      }
    });
    wrap.update();
    setTimeout(function () {
      expect(wrap.html()).to.equal('<div foo="a" bar="b"></div>');
      wrap.setState({
        p: {
          bar: "c"
        }
      });
      setTimeout(function () {
        expect(wrap.html()).to.equal('<div bar="c"></div>');
        done();
      });
    });
  });
});