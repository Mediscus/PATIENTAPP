"use strict";

var _interopRequireDefault = require("reshow-runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("reshow-runtime/helpers/interopRequireWildcard");

var _classCallCheck2 = _interopRequireDefault(require("reshow-runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("reshow-runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("reshow-runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("reshow-runtime/helpers/inherits"));

var _createSuper2 = _interopRequireDefault(require("reshow-runtime/helpers/createSuper"));

var _defineProperty2 = _interopRequireDefault(require("reshow-runtime/helpers/defineProperty"));

var _objectSpread2 = _interopRequireDefault(require("reshow-runtime/helpers/objectSpread2"));

var _objectWithoutProperties2 = _interopRequireDefault(require("reshow-runtime/helpers/objectWithoutProperties"));

var _slicedToArray2 = _interopRequireDefault(require("reshow-runtime/helpers/slicedToArray"));

var _react = _interopRequireWildcard(require("react"));

var _reshowFluxBase = require("reshow-flux-base");

var _chai = require("chai");

var _reshowUnit = require("reshow-unit");

var _useConnect = _interopRequireDefault(require("../useConnect"));

var _excluded = ["storeLocator"];
describe("Connect Hook (clean Props)", function () {
  var reducer;
  beforeEach(function () {
    reducer = (0, _reshowFluxBase.createReducer)(function (state, action) {
      return action;
    }, {});
  });
  it("test clean props", function (done) {
    var _reducer = reducer,
        _reducer2 = (0, _slicedToArray2["default"])(_reducer, 2),
        store = _reducer2[0],
        dispatch = _reducer2[1];

    var Foo = function Foo(props) {
      var state = (0, _useConnect["default"])({
        storeLocator: function storeLocator() {
          return store;
        },
        calculateState: function calculateState(prevState, props) {
          return store.getState();
        }
      })(props);
      var storeLocator = props.storeLocator,
          otherProps = (0, _objectWithoutProperties2["default"])(props, _excluded);
      return /*#__PURE__*/_react["default"].createElement("div", (0, _objectSpread2["default"])((0, _objectSpread2["default"])({}, otherProps), state));
    };

    var Bar = /*#__PURE__*/function (_Component) {
      (0, _inherits2["default"])(Bar, _Component);

      var _super = (0, _createSuper2["default"])(Bar);

      function Bar() {
        var _this;

        (0, _classCallCheck2["default"])(this, Bar);

        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
          args[_key] = arguments[_key];
        }

        _this = _super.call.apply(_super, [this].concat(args));
        (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "state", {
          p: null
        });
        return _this;
      }

      (0, _createClass2["default"])(Bar, [{
        key: "render",
        value: function render() {
          return /*#__PURE__*/_react["default"].createElement(Foo, this.state.p);
        }
      }]);
      return Bar;
    }(_react.Component);

    var wrap = (0, _reshowUnit.mount)( /*#__PURE__*/_react["default"].createElement(Bar, null));
    wrap.setState({
      p: {
        foo: "a",
        bar: "b"
      }
    });
    wrap.update();
    setTimeout(function () {
      (0, _chai.expect)(wrap.html()).to.equal('<div foo="a" bar="b"></div>');
      wrap.setState({
        p: {
          bar: "c"
        }
      });
      setTimeout(function () {
        (0, _chai.expect)(wrap.html()).to.equal('<div bar="c"></div>');
        done();
      });
    });
  });
});