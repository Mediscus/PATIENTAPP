import _objectWithoutProperties from "reshow-runtime/es/helpers/objectWithoutProperties";
import _classCallCheck from "reshow-runtime/es/helpers/classCallCheck";
import _createClass from "reshow-runtime/es/helpers/createClass";
import _inherits from "reshow-runtime/es/helpers/inherits";
import _createSuper from "reshow-runtime/es/helpers/createSuper";
var _excluded = ["comp"];

var _div, _div2, _div3, _div4, _div5;

import React, { PureComponent, isValidElement, Children } from "react";
import { expect } from "chai";
import { shallow } from "reshow-unit";
import build from "../index";
describe("Test build", function () {
  it("test build string", function () {
    var vdom = build("Foo Bar")();
    var actual = shallow(vdom).html();
    expect(actual).to.equal("<span>Foo Bar</span>");
  });
  it("test build native html", function () {
    var vdom = build("a")();
    var actual = shallow(vdom).html();
    expect(actual).to.equal("<a></a>");
  });
  it("test function with error", function () {
    var run = function run() {
      build(function (props) {
        expect(props.foo).to.equal("bar111");
      })({
        foo: "bar"
      });
    };

    expect(run).to["throw"]();
  });
  it("test function with return", function () {
    var a = build(function (props) {
      return props.foo;
    })({
      foo: "barbar"
    });
    expect(a).to.equal("barbar");
  });
  it("test with stateless function return", function () {
    var func = function func(props) {
      return /*#__PURE__*/React.createElement("div", props);
    };

    var a = build(func)({
      foo: "barbar"
    }); // will return react instance

    expect(a.props.foo).to.equal("barbar");
    expect( /*#__PURE__*/isValidElement(a)).to.be["true"];
  });
  it("test function return another component", function () {
    var FakeComponent = /*#__PURE__*/function (_PureComponent) {
      _inherits(FakeComponent, _PureComponent);

      var _super = _createSuper(FakeComponent);

      function FakeComponent() {
        _classCallCheck(this, FakeComponent);

        return _super.apply(this, arguments);
      }

      _createClass(FakeComponent, [{
        key: "render",
        value: function render() {
          return /*#__PURE__*/React.createElement("div", null, this.props.foo);
        }
      }]);

      return FakeComponent;
    }(PureComponent);

    var func = function func(props) {
      return /*#__PURE__*/React.createElement(FakeComponent, props);
    };

    var vDom = build(func)({
      foo: "bar3"
    });
    var html = shallow(vDom).html();
    expect(html).to.equal("<div>bar3</div>");
  });
  it("test with func and child", function () {
    var result = build(function (props) {
      return props;
    })({
      foo: "bar"
    }, "hello child");
    expect(result.children).to.equal("hello child");
    expect(result.foo).to.equal("bar");
  });
  it("test with anonymous func and child", function () {
    var child = [_div || (_div = /*#__PURE__*/React.createElement("div", {
      id: "1",
      key: "0"
    })), _div2 || (_div2 = /*#__PURE__*/React.createElement("div", {
      id: "2",
      key: "1"
    }))];
    var buildDom = build(function (_ref) {
      var children = _ref.children;
      return /*#__PURE__*/React.createElement("div", {
        id: "root"
      }, children);
    })({}, child);
    var html = shallow( /*#__PURE__*/React.createElement("div", null, buildDom)).html();

    var stateFunc = function stateFunc(_ref2) {
      var children = _ref2.children;
      return /*#__PURE__*/React.createElement("div", {
        id: "root"
      }, children);
    };

    var stateFuncBuildDom = build(stateFunc)({}, child);
    var stateFuncHtml = shallow( /*#__PURE__*/React.createElement("div", null, stateFuncBuildDom)).html();
    var expected = '<div><div id="root"><div id="1"></div><div id="2"></div></div></div>';
    expect(html).to.equal(expected);
    expect(stateFuncHtml).to.equal(expected);
  });
  it("test with component", function () {
    var FakeComponent = function FakeComponent(props) {
      return /*#__PURE__*/React.createElement("div", null, props.foo);
    };

    var vDom = build(FakeComponent)({
      foo: "bar"
    });
    var html = shallow(vDom).html();
    expect(html).to.equal("<div>bar</div>");
  });
  it("test with instance", function () {
    var FakeComponent = function FakeComponent(props) {
      return /*#__PURE__*/React.createElement("div", null, props.foo);
    };

    var vDom = /*#__PURE__*/React.createElement(FakeComponent, null);
    var html = shallow(build(vDom)({
      foo: "bar1"
    })).html();
    expect(html).to.equal("<div>bar1</div>");
  });
  it("test with class component", function () {
    var FakeComponent = /*#__PURE__*/function (_PureComponent2) {
      _inherits(FakeComponent, _PureComponent2);

      var _super2 = _createSuper(FakeComponent);

      function FakeComponent() {
        _classCallCheck(this, FakeComponent);

        return _super2.apply(this, arguments);
      }

      _createClass(FakeComponent, [{
        key: "render",
        value: function render() {
          return /*#__PURE__*/React.createElement("div", null, this.props.foo);
        }
      }]);

      return FakeComponent;
    }(PureComponent);

    var vDom = build(FakeComponent)({
      foo: "bar2"
    });
    var html = shallow(vDom).html();
    expect(html).to.equal("<div>bar2</div>");
  });
  it("test with clone and child", function () {
    var FakeComponent = /*#__PURE__*/function (_PureComponent3) {
      _inherits(FakeComponent, _PureComponent3);

      var _super3 = _createSuper(FakeComponent);

      function FakeComponent() {
        _classCallCheck(this, FakeComponent);

        return _super3.apply(this, arguments);
      }

      _createClass(FakeComponent, [{
        key: "render",
        value: function render() {
          var _this$props = this.props,
              comp = _this$props.comp,
              others = _objectWithoutProperties(_this$props, _excluded);

          return build(comp)(others, "bar");
        }
      }]);

      return FakeComponent;
    }(PureComponent);

    var html = shallow( /*#__PURE__*/React.createElement(FakeComponent, {
      id: "foo",
      comp: _div3 || (_div3 = /*#__PURE__*/React.createElement("div", null, "foo"))
    })).html();
    expect(html).to.equal('<div id="foo">bar</div>');
  });
  it("test with class and child", function () {
    var FakeComponent = /*#__PURE__*/function (_PureComponent4) {
      _inherits(FakeComponent, _PureComponent4);

      var _super4 = _createSuper(FakeComponent);

      function FakeComponent() {
        _classCallCheck(this, FakeComponent);

        return _super4.apply(this, arguments);
      }

      _createClass(FakeComponent, [{
        key: "render",
        value: function render() {
          return /*#__PURE__*/React.createElement("div", this.props);
        }
      }]);

      return FakeComponent;
    }(PureComponent);

    var vDom = build(FakeComponent)({
      id: "foo"
    }, "hello");
    var html = shallow(vDom).html();
    expect(html).to.equal('<div id="foo">hello</div>');
  });
  it("test with empty", function () {
    var result = build()();
    expect(result).to.be["null"];
  });
});
describe("Test build with key", function () {
  it("with one child", function () {
    var comp = _div4 || (_div4 = /*#__PURE__*/React.createElement("div", null));

    var buildComp = build(comp)({
      key: "foo"
    });
    expect(buildComp.key).to.equal("foo");
  });
  it("with multi child", function () {
    var comp = _div5 || (_div5 = /*#__PURE__*/React.createElement("div", null));

    var buildComp = build([comp, comp])({
      key: "foo"
    });
    expect(buildComp[0].key !== buildComp[1].key).be["true"];
  });
});