"use strict";

var _interopRequireWildcard = require("reshow-runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("reshow-runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _typeof2 = _interopRequireDefault(require("reshow-runtime/helpers/typeof"));

var _react = _interopRequireWildcard(require("react"));

var _reshowConstant = require("reshow-constant");

var _array = require("array.merge");

var buildFunc = function buildFunc(component, props, child, componentOption) {
  // anonymous function will call directly
  var _ref = componentOption || {},
      wrap = _ref.wrap,
      doCallFunction = _ref.doCallFunction;

  if (_reshowConstant.FUNCTION === (0, _typeof2["default"])(component) && !component.name || doCallFunction) {
    try {
      if (child != _reshowConstant.T_NULL) {
        props.children = child;
      }

      var el = component(props);
      return wrap && ! /*#__PURE__*/(0, _react.isValidElement)(el) ? buildReact(wrap, props, el) : el;
    } catch (e) {
      if (e.name === _reshowConstant.TYPE_ERROR) {
        return buildReact(component, props, child);
      } else {
        throw e;
      }
    }
  } else {
    return buildReact(component, props, child);
  }
};

var buildReact = function buildReact(component, props, child) {
  var params = [component, props];

  if (child != _reshowConstant.T_NULL) {
    params.push(child);
  }

  if (_reshowConstant.STRING === (0, _typeof2["default"])(component) && component !== component.replace(/[^a-z]/g, "")) {
    return buildReact( /*#__PURE__*/_react["default"].createElement("span", null, component), props, child);
  } else {
    return ( /*#__PURE__*/(0, _react.isValidElement)(component) ? _react.cloneElement : _react.createElement).apply(_reshowConstant.T_NULL, params);
  }
};

var build = function build(component, componentOption) {
  return function (props, child) {
    if (!component) {
      return _reshowConstant.T_NULL;
    }

    var _ref2 = componentOption || {},
        wrap = _ref2.wrap,
        doCallFunction = _ref2.doCallFunction;

    if (wrap) {
      if (_reshowConstant.FUNCTION !== (0, _typeof2["default"])(component) && ! /*#__PURE__*/(0, _react.isValidElement)(component)) {
        child = component;
        component = wrap;
      }
    }

    props = (0, _array.removeEmpty)(props, _reshowConstant.T_TRUE);

    if (component.map) {
      delete props.key;
    }

    var run = function run(comp) {
      return ( /*#__PURE__*/(0, _react.isValidElement)(comp) ? buildReact : buildFunc)(comp, props, child, componentOption);
    };

    return component.map ? _react.Children.map(component.map(function (comp) {
      return run(comp);
    }), function (c) {
      return c;
    }) : run(component);
  };
};

var _default = build;
exports["default"] = _default;
module.exports = exports.default;